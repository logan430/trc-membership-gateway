---
phase: 09-frontend-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/index.ts
  - public/styles.css
  - public/signup.html
  - public/login.html
  - src/routes/public.ts
autonomous: true

must_haves:
  truths:
    - "User can access /auth/signup and see registration form"
    - "User can access /auth/login and see login form"
    - "User can create account via signup form"
    - "User can authenticate via login form"
    - "Forms follow medieval theme (gold, dark bg, Cinzel/Crimson fonts)"
    - "No CSP errors block page functionality"
  artifacts:
    - path: "public/signup.html"
      provides: "Registration form with email/password inputs"
      min_lines: 80
    - path: "public/login.html"
      provides: "Login form with email/password inputs"
      min_lines: 70
    - path: "public/styles.css"
      provides: "Form-specific CSS classes"
      contains: ".form-input"
    - path: "src/routes/public.ts"
      provides: "Routes for /auth/signup and /auth/login"
      contains: "/auth/signup"
  key_links:
    - from: "public/signup.html"
      to: "/auth/signup"
      via: "fetch POST on form submit"
      pattern: "fetch.*auth/signup.*POST"
    - from: "public/login.html"
      to: "/auth/login"
      via: "fetch POST on form submit"
      pattern: "fetch.*auth/login.*POST"
    - from: "src/routes/public.ts"
      to: "public/signup.html"
      via: "res.sendFile"
      pattern: "sendFile.*signup\\.html"
---

<objective>
Create signup and login HTML pages with medieval theme styling so users can register and authenticate via the browser.

Purpose: Provides the browser-facing entry point for user registration and authentication. These pages call the existing `/auth/signup` and `/auth/login` API endpoints.

Output: Two HTML pages (signup.html, login.html), form styles in CSS, routes in public.ts, and CSP configuration for inline scripts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-frontend-pages/09-RESEARCH.md

# Existing patterns to follow:
@public/team-dashboard.html (lines 1-100 for structure, 600-800 for JS patterns)
@public/styles.css
@src/routes/public.ts
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Helmet CSP for inline scripts and Google Fonts</name>
  <files>src/index.ts</files>
  <action>
    Update Helmet configuration to allow inline scripts and Google Fonts.

    Replace `app.use(helmet())` with:
    ```typescript
    app.use(helmet({
      contentSecurityPolicy: {
        directives: {
          defaultSrc: ["'self'"],
          scriptSrc: ["'self'", "'unsafe-inline'"],
          styleSrc: ["'self'", "'unsafe-inline'", "https://fonts.googleapis.com"],
          fontSrc: ["'self'", "https://fonts.gstatic.com"],
          imgSrc: ["'self'", "data:"],
          connectSrc: ["'self'"],
        },
      },
    }));
    ```

    This allows:
    - Inline `<script>` tags (matching team-dashboard.html pattern)
    - Inline `<style>` blocks
    - Google Fonts CSS from fonts.googleapis.com
    - Font files from fonts.gstatic.com
    - Same-origin fetch/XHR requests
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no TypeScript errors.
    Start server with `npm run dev` and verify console shows no CSP-related warnings.
  </verify>
  <done>Helmet is configured with CSP allowing inline scripts, inline styles, and Google Fonts</done>
</task>

<task type="auto">
  <name>Task 2: Add form styles and create auth pages with routes</name>
  <files>public/styles.css, public/signup.html, public/login.html, src/routes/public.ts</files>
  <action>
    **2a. Add form styles to public/styles.css:**

    Append the following CSS classes after the existing styles:

    ```css
    /* Auth Form Styles */
    .auth-container {
      max-width: 400px;
      margin: 4rem auto;
      padding: 2rem;
    }

    .auth-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 2rem;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .auth-header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .auth-header p {
      color: var(--text-muted);
      font-style: italic;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--gold);
      font-family: 'Cinzel', serif;
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-dark);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      color: var(--text);
      font-family: 'Crimson Text', serif;
      font-size: 1rem;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--gold);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    .form-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
      padding: 0.75rem 1rem;
      border-radius: 4px;
      margin-bottom: 1rem;
      display: none;
    }

    .form-error.visible {
      display: block;
    }

    .form-button {
      width: 100%;
      padding: 0.875rem 1.5rem;
      background: var(--gold);
      border: none;
      border-radius: 4px;
      color: var(--bg-dark);
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .form-button:hover {
      background: var(--gold-light);
      transform: translateY(-2px);
    }

    .form-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .form-footer {
      text-align: center;
      margin-top: 1.5rem;
      color: var(--text-muted);
    }

    .form-footer a {
      color: var(--gold);
      text-decoration: none;
    }

    .form-footer a:hover {
      text-decoration: underline;
    }

    .form-divider {
      display: flex;
      align-items: center;
      margin: 1.5rem 0;
      color: var(--text-muted);
    }

    .form-divider::before,
    .form-divider::after {
      content: '';
      flex: 1;
      border-bottom: 1px solid var(--border-subtle);
    }

    .form-divider span {
      padding: 0 1rem;
      font-size: 0.9rem;
    }
    ```

    **2b. Create public/signup.html:**

    Follow team-dashboard.html structure exactly:
    - Same head structure (meta, title, stylesheet, Google Fonts)
    - Inline `<style>` for page-specific styles (minimal, mostly use form classes)
    - Inline `<script>` at end of body

    Form fields:
    - Email input (type="email", required)
    - Password input (type="password", required, minlength="8")
    - Confirm password input (type="password", required)
    - Submit button "Create Account"
    - Link to login: "Already have an account? Sign in"

    JavaScript behavior:
    1. On submit, validate passwords match
    2. Disable button, show loading state
    3. POST to /auth/signup with { email, password }
    4. On success: store accessToken in localStorage, redirect to /app/dashboard
    5. On error: show error message, re-enable button

    **2c. Create public/login.html:**

    Same structure as signup.html but simpler:
    - Email input
    - Password input
    - Submit button "Sign In"
    - Link to signup: "Don't have an account? Create one"
    - Support ?redirect query param for post-login redirect

    JavaScript behavior:
    1. On load, check for token in URL hash (magic link callback support)
    2. On submit, disable button, POST to /auth/login with { email, password }
    3. On success: store accessToken, redirect to ?redirect param OR /app/dashboard
    4. On error: show error, re-enable button

    **2d. Add routes to src/routes/public.ts:**

    Add BEFORE the root `/` route:
    ```typescript
    publicRouter.get('/auth/signup', (_req: Request, res: Response): void => {
      res.sendFile(join(__dirname, '../../public/signup.html'));
    });

    publicRouter.get('/auth/login', (_req: Request, res: Response): void => {
      res.sendFile(join(__dirname, '../../public/login.html'));
    });
    ```
  </action>
  <verify>
    1. Run `npx tsc --noEmit` - no TypeScript errors
    2. Start server with `npm run dev`
    3. Navigate to http://localhost:3000/auth/signup - form displays with medieval theme
    4. Navigate to http://localhost:3000/auth/login - form displays with medieval theme
    5. Open browser devtools console - no CSP errors
    6. Test signup flow: fill form, submit, should redirect to /app/dashboard (will 404 for now, that's expected)
    7. Test login flow: fill form with created account, submit, should redirect
  </verify>
  <done>
    - Form CSS classes added to styles.css
    - signup.html created with registration form and JS
    - login.html created with login form and JS
    - Routes added to public.ts for /auth/signup and /auth/login
    - All pages follow team-dashboard.html patterns exactly
  </done>
</task>

</tasks>

<verification>
1. CSP configured - no console errors about refused inline scripts or fonts
2. http://localhost:3000/auth/signup displays registration form with gold/dark theme
3. http://localhost:3000/auth/login displays login form with gold/dark theme
4. Signup form submits to API and stores token in localStorage
5. Login form submits to API and stores token in localStorage
6. Redirect after auth works (to /app/dashboard which will be created in 09-02)
7. Form styles match existing medieval theme (Cinzel headers, Crimson body, gold accents)
</verification>

<success_criteria>
- User can access /auth/signup and create account via form
- User can access /auth/login and authenticate via form
- accessToken is stored in localStorage after successful auth
- No CSP errors in browser console
- Pages follow established team-dashboard.html patterns
- Form styling matches medieval theme
</success_criteria>

<output>
After completion, create `.planning/phases/09-frontend-pages/09-01-SUMMARY.md`
</output>
