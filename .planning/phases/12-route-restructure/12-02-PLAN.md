---
phase: 12-route-restructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/routes/public.ts
  - public/admin/login.html
  - public/admin/dashboard.html
  - public/admin/members.html
  - public/admin/member-detail.html
  - public/admin/config.html
  - public/admin/audit.html
  - public/admin/admins.html
  - public/admin/templates.html
autonomous: true

must_haves:
  truths:
    - "Admin can access login page at /app/admin/login"
    - "Admin can access dashboard at /app/admin/dashboard"
    - "Admin can access all admin pages at /app/admin/*"
    - "Old admin routes (/admin/login, /admin/dashboard, etc.) return 404"
    - "All admin navigation links point to new /app/admin/* paths"
  artifacts:
    - path: "src/routes/public.ts"
      provides: "Updated admin page route definitions"
      contains: "/app/admin/login"
    - path: "public/admin/dashboard.html"
      provides: "Dashboard with updated navigation"
      contains: "/app/admin/members"
    - path: "public/admin/login.html"
      provides: "Login page with updated redirect"
      contains: "/app/admin/dashboard"
  key_links:
    - from: "public/admin/dashboard.html"
      to: "/app/admin/members"
      via: "navigation href"
      pattern: 'href="/app/admin/members"'
    - from: "public/admin/login.html"
      to: "/app/admin/dashboard"
      via: "JavaScript redirect"
      pattern: "location.href.*'/app/admin/dashboard'"
---

<objective>
Migrate admin page routes from /admin/* to /app/admin/* for consistent URL structure.

Purpose: Part 2 of route restructure - moves all 8 admin page routes to /app/admin/* while keeping admin API routes at /admin/auth/* and /api/admin/* unchanged.

Output: Admin pages accessible at new /app/admin/* paths, all navigation links updated, old routes return 404.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-route-restructure/12-CONTEXT.md
@.planning/phases/12-route-restructure/12-RESEARCH.md
@src/routes/public.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update admin page routes in backend</name>
  <files>src/routes/public.ts</files>
  <action>
Update all admin page route definitions from /admin/* to /app/admin/*:

Routes to change (8 total):
1. `/admin/login` -> `/app/admin/login`
2. `/admin/dashboard` -> `/app/admin/dashboard`
3. `/admin/members` -> `/app/admin/members`
4. `/admin/members/:id` -> `/app/admin/members/:id`
5. `/admin/config` -> `/app/admin/config`
6. `/admin/audit` -> `/app/admin/audit`
7. `/admin/admins` -> `/app/admin/admins`
8. `/admin/templates` -> `/app/admin/templates`

Update JSDoc comments to reflect new paths.

IMPORTANT: Only change the PAGE routes. Do NOT touch:
- API routes in src/routes/admin/*.ts
- Admin auth routes at /admin/auth/* (login API, logout API, refresh API)
- The actual HTML file paths being served (they stay at public/admin/*.html)

Example transformation:
```typescript
// Before
publicRouter.get('/admin/dashboard', (_req: Request, res: Response): void => {
  res.sendFile(join(__dirname, '../../public/admin/dashboard.html'));
});

// After
publicRouter.get('/app/admin/dashboard', (_req: Request, res: Response): void => {
  res.sendFile(join(__dirname, '../../public/admin/dashboard.html'));
});
```
  </action>
  <verify>
Run TypeScript compilation: `npx tsc --noEmit`
Grep to confirm new routes: `grep -n "/app/admin/" src/routes/public.ts`
Count should show 8 route definitions.
Grep to confirm old routes removed: `grep -n "'/admin/login'\|'/admin/dashboard'\|'/admin/members'\|'/admin/config'\|'/admin/audit'\|'/admin/admins'\|'/admin/templates'" src/routes/public.ts` (should return nothing)
  </verify>
  <done>
- All 8 admin page routes updated to /app/admin/* pattern
- Old /admin/* page routes no longer exist in public.ts
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update admin HTML navigation and redirects</name>
  <files>
public/admin/login.html
public/admin/dashboard.html
public/admin/members.html
public/admin/member-detail.html
public/admin/config.html
public/admin/audit.html
public/admin/admins.html
public/admin/templates.html
  </files>
  <action>
Update all navigation links and JavaScript redirects in admin HTML files from /admin/* to /app/admin/*.

**Pattern to search and replace:**
- `href="/admin/` -> `href="/app/admin/`
- `location.href = '/admin/` -> `location.href = '/app/admin/`
- `window.location.href = '/admin/` -> `window.location.href = '/app/admin/`
- `window.location = '/admin/` -> `window.location = '/app/admin/`

**Files and expected changes (~119 total occurrences):**

1. **public/admin/login.html** (~4 occurrences):
   - Redirect after successful login to /app/admin/dashboard
   - Any navigation links

2. **public/admin/dashboard.html** (~22 occurrences):
   - All navigation menu links (members, config, audit, admins, templates)
   - Logout redirect to /app/admin/login
   - Any member detail links (/admin/members/{id})

3. **public/admin/members.html** (~14 occurrences):
   - Navigation menu links
   - Member detail links (/admin/members/{id})
   - Auth redirect to /app/admin/login

4. **public/admin/member-detail.html** (~16 occurrences):
   - Navigation menu links
   - Back to members link
   - Auth redirect to /app/admin/login

5. **public/admin/config.html** (~16 occurrences):
   - Navigation menu links
   - Auth redirect to /app/admin/login

6. **public/admin/audit.html** (~14 occurrences):
   - Navigation menu links
   - Auth redirect to /app/admin/login

7. **public/admin/admins.html** (~17 occurrences):
   - Navigation menu links
   - Auth redirect to /app/admin/login

8. **public/admin/templates.html** (~16 occurrences):
   - Navigation menu links
   - Auth redirect to /app/admin/login

IMPORTANT - Do NOT change:
- API fetch calls to /admin/auth/* (login, logout, refresh APIs)
- API fetch calls to /api/admin/* (member management, config, audit APIs)
- Static asset paths like /admin/styles.css
- The HTML file paths in route definitions (handled in Task 1)

**Distinction:**
- Page links (CHANGE): `href="/admin/dashboard"` -> `href="/app/admin/dashboard"`
- API calls (KEEP): `fetch('/admin/auth/login'` stays as is
- API calls (KEEP): `fetch('/api/admin/members'` stays as is
  </action>
  <verify>
Grep to confirm no old admin page links remain (excluding API paths):
```bash
grep -rn 'href="/admin/' public/admin/
```
Should return no results.

Grep to confirm new links exist:
```bash
grep -rn 'href="/app/admin/' public/admin/
```
Should show many results.

Grep to confirm API calls unchanged:
```bash
grep -rn "fetch('/admin/auth" public/admin/
grep -rn "fetch('/api/admin" public/admin/
```
Should show API calls still pointing to /admin/auth/* and /api/admin/*.
  </verify>
  <done>
- All 8 admin HTML files updated
- Navigation links point to /app/admin/*
- JavaScript redirects point to /app/admin/*
- API fetch calls to /admin/auth/* unchanged
- API fetch calls to /api/admin/* unchanged
- No orphaned /admin/* page links remain
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify admin route migration</name>
  <files>src/routes/public.ts</files>
  <action>
Start the dev server and verify the admin route changes work correctly:

1. Run `npm run dev` to start the server
2. Test new routes respond correctly:
   - GET /app/admin/login should return admin/login.html (200 OK)
   - GET /app/admin/dashboard should return admin/dashboard.html (200 OK)
   - GET /app/admin/members should return admin/members.html (200 OK)
   - GET /app/admin/members/123 should return admin/member-detail.html (200 OK)
   - GET /app/admin/config should return admin/config.html (200 OK)
   - GET /app/admin/audit should return admin/audit.html (200 OK)
   - GET /app/admin/admins should return admin/admins.html (200 OK)
   - GET /app/admin/templates should return admin/templates.html (200 OK)
3. Test old routes return 404:
   - GET /admin/login should return 404
   - GET /admin/dashboard should return 404
4. Verify API routes still work:
   - POST /admin/auth/login should still work (not a page route)
   - GET /api/admin/members should still work (not a page route)

Use curl to verify pages:
```bash
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/app/admin/login
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/app/admin/dashboard
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/admin/login
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/admin/dashboard
```

Expected: 200, 200, 404, 404
  </action>
  <verify>
- All 8 /app/admin/* routes return 200
- Old /admin/* page routes return 404
- Admin auth API (/admin/auth/*) still functional
- Admin API (/api/admin/*) still functional
- No console errors in server output
  </verify>
  <done>
- New admin page routes serve HTML correctly
- Old admin page routes return 404
- API routes unaffected
- Server starts without errors
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Route definitions:** `grep -c "/app/admin/" src/routes/public.ts` shows 8 routes
2. **No old routes:** `grep -n "'/admin/login'\|'/admin/dashboard'" src/routes/public.ts` returns empty
3. **HTML links updated:** `grep -rn "/app/admin/" public/admin/` shows many results
4. **No stale page links:** `grep -rn 'href="/admin/' public/admin/` returns empty
5. **API calls preserved:** `grep -rn "fetch('/admin/auth" public/admin/` shows API calls
6. **TypeScript compiles:** `npx tsc --noEmit` succeeds
7. **Server starts:** `npm run dev` starts without errors
</verification>

<success_criteria>
- All 8 admin pages accessible at /app/admin/* paths
- Old /admin/* page routes return 404
- All navigation links point to new paths
- Admin API routes at /admin/auth/* and /api/admin/* still function
- TypeScript compiles without errors
- Server starts and responds correctly
</success_criteria>

<output>
After completion, create `.planning/phases/12-route-restructure/12-02-SUMMARY.md`
</output>
