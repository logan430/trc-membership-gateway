---
phase: 14-admin-filter-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/routes/admin/members.ts
  - public/admin/members.html
autonomous: true

must_haves:
  truths:
    - "Admin can filter members by ACTIVE subscription status"
    - "Admin can filter members by PAST_DUE subscription status"
    - "Admin can filter members by CANCELLED subscription status"
    - "Admin can filter members by TRIALING subscription status"
    - "Admin can filter members by NONE subscription status"
    - "Dashboard stat counts reflect actual filtered results"
  artifacts:
    - path: "src/routes/admin/members.ts"
      provides: "Query schema with subscriptionStatus parameter"
      contains: "subscriptionStatus:"
    - path: "public/admin/members.html"
      provides: "Filter dropdown with all status options"
      contains: "TRIALING"
  key_links:
    - from: "public/admin/members.html"
      to: "/api/admin/members"
      via: "fetch with subscriptionStatus query param"
      pattern: "subscriptionStatus"
    - from: "src/routes/admin/members.ts"
      to: "prisma.member.findMany"
      via: "query.subscriptionStatus condition"
      pattern: "query\\.subscriptionStatus"
---

<objective>
Fix admin subscription status filter parameter mismatch.

Purpose: The admin members page filter silently fails because frontend sends `subscriptionStatus` but backend expects `status`. Zod strips unknown fields, causing all members to be returned regardless of filter selection.

Output: Working subscription status filter on admin members page and accurate dashboard stat counts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-admin-filter-fix/14-RESEARCH.md
@src/routes/admin/members.ts
@public/admin/members.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix backend parameter name</name>
  <files>src/routes/admin/members.ts</files>
  <action>
  In src/routes/admin/members.ts, rename the query parameter from `status` to `subscriptionStatus`:

  1. Line 15: Change `status:` to `subscriptionStatus:` in listQuerySchema
  2. Line 43: Change `if (query.status)` to `if (query.subscriptionStatus)`
  3. Line 44: Change `query.status` to `query.subscriptionStatus`

  The enum values remain unchanged: ['NONE', 'TRIALING', 'ACTIVE', 'PAST_DUE', 'CANCELLED']
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Backend accepts `subscriptionStatus` query parameter for filtering</done>
</task>

<task type="auto">
  <name>Task 2: Add TRIALING option to filter dropdown</name>
  <files>public/admin/members.html</files>
  <action>
  In public/admin/members.html, add TRIALING option to the status filter dropdown.

  Find the select element with id="status" (around lines 40-46) and add TRIALING option after ACTIVE:

  ```html
  <select id="status">
    <option value="">All Statuses</option>
    <option value="ACTIVE">Active</option>
    <option value="TRIALING">Trialing</option>
    <option value="PAST_DUE">Past Due</option>
    <option value="CANCELLED">Cancelled</option>
    <option value="NONE">None</option>
  </select>
  ```

  This ensures admins can filter by all possible subscription statuses.
  </action>
  <verify>File contains TRIALING option in the select element</verify>
  <done>Filter dropdown includes all 5 subscription status options</done>
</task>

</tasks>

<verification>
1. Start dev server: `npm run dev`
2. Login to admin at /app/admin/login
3. Navigate to /app/admin/members
4. Select "Active" from Status dropdown - verify only ACTIVE members shown
5. Select "Past Due" from Status dropdown - verify only PAST_DUE members shown
6. Select "Trialing" from Status dropdown - verify only TRIALING members shown (may be 0)
7. Verify dashboard at /app/admin/dashboard shows correct stat counts
</verification>

<success_criteria>
1. Admin dashboard filter parameter matches backend expectation (subscriptionStatus)
2. Filtering by subscription status returns correct results
3. All filter states work: ACTIVE, TRIALING, PAST_DUE, CANCELLED, NONE
</success_criteria>

<output>
After completion, create `.planning/phases/14-admin-filter-fix/14-01-SUMMARY.md`
</output>
