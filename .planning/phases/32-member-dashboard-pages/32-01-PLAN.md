---
phase: 32-member-dashboard-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/package.json
  - dashboard/src/lib/queries.ts
  - dashboard/src/hooks/usePoints.ts
  - dashboard/src/app/dashboard/page.tsx
  - dashboard/src/app/providers.tsx
autonomous: true

must_haves:
  truths:
    - "Overview page shows member's real total points from API"
    - "Overview page shows real streak and rank data"
    - "Activity feed displays actual point transactions from history"
    - "Loading state shows while data fetches"
  artifacts:
    - path: "dashboard/src/lib/queries.ts"
      provides: "React Query configuration and query factories"
      exports: ["queryClient", "pointsQueries"]
    - path: "dashboard/src/hooks/usePoints.ts"
      provides: "Points data hooks"
      exports: ["usePointsSummary", "usePointsHistory"]
    - path: "dashboard/src/app/providers.tsx"
      provides: "Client-side providers wrapper"
      exports: ["Providers"]
  key_links:
    - from: "dashboard/src/app/dashboard/page.tsx"
      to: "usePointsSummary hook"
      via: "React Query data fetching"
      pattern: "usePointsSummary\\(\\)"
    - from: "dashboard/src/hooks/usePoints.ts"
      to: "dashboard/src/lib/api.ts"
      via: "API client methods"
      pattern: "pointsApi\\.(getSummary|getHistory)"
---

<objective>
Connect dashboard overview to real backend data using React Query.

Purpose: Replace hardcoded placeholder data with live member stats. Validates the data fetching pattern for all subsequent pages.

Output: Working overview page showing real points, streak, rank, and activity from /api/points endpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-member-dashboard-pages/32-CONTEXT.md
@.planning/phases/32-member-dashboard-pages/32-RESEARCH.md

# Existing files to understand
@dashboard/src/lib/api.ts
@dashboard/src/app/dashboard/page.tsx
@dashboard/src/app/dashboard/layout.tsx
@src/routes/points.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install React Query and create provider setup</name>
  <files>
    dashboard/package.json
    dashboard/src/lib/queries.ts
    dashboard/src/app/providers.tsx
    dashboard/src/app/layout.tsx
  </files>
  <action>
1. Install @tanstack/react-query in dashboard:
   ```bash
   cd dashboard && npm install @tanstack/react-query
   ```

2. Create dashboard/src/lib/queries.ts:
   - Export QueryClient with default options (staleTime: 30_000, gcTime: 5 * 60 * 1000)
   - Create pointsQueries object with query key factories:
     - summary: ['points', 'summary']
     - history: (cursor?: string) => ['points', 'history', { cursor }]
   - Export query options factories that combine keys with queryFn

3. Create dashboard/src/app/providers.tsx:
   - 'use client' directive
   - Create Providers component wrapping QueryClientProvider
   - Use useState to create QueryClient instance (not module-level for SSR safety)

4. Update dashboard/src/app/layout.tsx:
   - Import Providers from ./providers
   - Wrap {children} with Providers component
  </action>
  <verify>
    - npm ls @tanstack/react-query shows installed
    - dashboard/src/lib/queries.ts exports queryClient and pointsQueries
    - dashboard/src/app/providers.tsx exports Providers component
    - No TypeScript errors: cd dashboard && npx tsc --noEmit
  </verify>
  <done>React Query installed and configured with providers wrapping app</done>
</task>

<task type="auto">
  <name>Task 2: Create points hooks and update overview page</name>
  <files>
    dashboard/src/hooks/usePoints.ts
    dashboard/src/app/dashboard/page.tsx
  </files>
  <action>
1. Create dashboard/src/hooks/usePoints.ts:
   ```typescript
   'use client';

   import { useQuery } from '@tanstack/react-query';
   import { pointsApi } from '@/lib/api';

   export function usePointsSummary() {
     return useQuery({
       queryKey: ['points', 'summary'],
       queryFn: () => pointsApi.getSummary(),
       staleTime: 30_000,
     });
   }

   export function usePointsHistory(limit = 10) {
     return useQuery({
       queryKey: ['points', 'history', { limit }],
       queryFn: () => pointsApi.getHistory(limit, 0),
       staleTime: 30_000,
     });
   }
   ```

2. Update dashboard/src/app/dashboard/page.tsx:
   - Add 'use client' directive
   - Import usePointsSummary, usePointsHistory hooks
   - Import GoldCoinsLoader from @/components/ui
   - Replace hardcoded StatCard values with data from usePointsSummary:
     - Gold Earned: data.totalPoints (format with toLocaleString)
     - Guild Rank: Show placeholder "#--" until leaderboard API ready (Phase 32-05)
     - Current Streak: data.currentStreak + " days"
   - Replace hardcoded ActivityItem list with data from usePointsHistory:
     - Map transactions to ActivityItem components
     - Show transaction.actionLabel as action text
     - Show transaction.points with + prefix if positive
     - Format createdAt as relative time (e.g., "2 hours ago")
   - Show GoldCoinsLoader when isLoading
   - Show error message if error state

3. Create simple relative time formatter:
   ```typescript
   function formatRelativeTime(date: string): string {
     const now = new Date();
     const then = new Date(date);
     const diffMs = now.getTime() - then.getTime();
     const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
     const diffDays = Math.floor(diffHours / 24);

     if (diffHours < 1) return 'Just now';
     if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
     if (diffDays === 1) return 'Yesterday';
     return `${diffDays} days ago`;
   }
   ```
  </action>
  <verify>
    - cd dashboard && npm run build succeeds
    - Start both servers (Express on 4000, Next.js on 3000)
    - Navigate to /dashboard in browser
    - Gold Earned shows real totalPoints value from API
    - Current Streak shows real streak value
    - Activity feed shows real recent transactions
    - Loading spinner appears briefly on initial load
  </verify>
  <done>Overview page displays real member data from backend API</done>
</task>

</tasks>

<verification>
1. npm run build in dashboard directory completes without errors
2. Browser dev tools Network tab shows /api/points/summary and /api/points/history requests
3. Response data matches what displays on page
4. Refresh page - data loads from cache initially (staleTime), then refetches
</verification>

<success_criteria>
- Overview page shows member's actual totalPoints, currentStreak from database
- Activity feed shows real point transaction history with action labels
- Loading state displays GoldCoinsLoader while fetching
- No console errors in browser
- React Query devtools (if enabled) shows queries cached correctly
</success_criteria>

<output>
After completion, create `.planning/phases/32-member-dashboard-pages/32-01-SUMMARY.md`
</output>
