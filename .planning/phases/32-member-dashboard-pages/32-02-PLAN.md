---
phase: 32-member-dashboard-pages
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/src/lib/api.ts
  - dashboard/src/hooks/useResources.ts
  - dashboard/src/components/resources/ResourceCard.tsx
  - dashboard/src/components/resources/ResourceListItem.tsx
  - dashboard/src/components/resources/ResourceFilters.tsx
  - dashboard/src/components/resources/ResourcePreviewModal.tsx
  - dashboard/src/components/resources/index.ts
  - dashboard/src/app/dashboard/resources/page.tsx
autonomous: true

must_haves:
  truths:
    - "Member can browse resources with search and filters"
    - "Member can toggle between grid and list view"
    - "Member can preview resource details in modal"
    - "Member can download resource and receive points"
  artifacts:
    - path: "dashboard/src/hooks/useResources.ts"
      provides: "Resource data hooks with filters"
      exports: ["useResources", "useResourceTags", "useDownloadResource"]
    - path: "dashboard/src/components/resources/ResourceCard.tsx"
      provides: "Grid view resource card"
      exports: ["ResourceCard"]
    - path: "dashboard/src/components/resources/ResourcePreviewModal.tsx"
      provides: "Resource detail modal with download"
      exports: ["ResourcePreviewModal"]
    - path: "dashboard/src/app/dashboard/resources/page.tsx"
      provides: "Resources page with browser UI"
      min_lines: 80
  key_links:
    - from: "dashboard/src/app/dashboard/resources/page.tsx"
      to: "/api/resources"
      via: "useResources hook"
      pattern: "useResources\\("
    - from: "ResourcePreviewModal"
      to: "/api/resources/:id/download"
      via: "useDownloadResource mutation"
      pattern: "useDownloadResource\\("
---

<objective>
Build the resource library browser page with filtering, grid/list toggle, and download functionality.

Purpose: Members can browse curated resources (templates, SOPs, playbooks) and download them to earn points.

Output: /dashboard/resources page with working search, filters, view toggle, preview modal, and download tracking.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-member-dashboard-pages/32-CONTEXT.md
@.planning/phases/32-member-dashboard-pages/32-RESEARCH.md

# Existing files
@dashboard/src/lib/api.ts
@dashboard/src/components/ui/index.ts
@src/routes/resources.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create resource hooks and update API client</name>
  <files>
    dashboard/src/lib/api.ts
    dashboard/src/hooks/useResources.ts
  </files>
  <action>
1. Update dashboard/src/lib/api.ts resourcesApi:
   - Add getTags method: GET /api/resources/tags -> { tags: string[] }
   - Ensure list method returns { resources: Resource[], nextCursor, hasMore }
   - Add featured field to Resource interface if missing

2. Create dashboard/src/hooks/useResources.ts:
   ```typescript
   'use client';

   import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
   import { resourcesApi, Resource } from '@/lib/api';

   interface ResourceFilters {
     search?: string;
     tags?: string;
     type?: string;
     featured?: boolean;
   }

   export function useResources(filters: ResourceFilters = {}) {
     return useQuery({
       queryKey: ['resources', filters],
       queryFn: () => resourcesApi.list({
         search: filters.search,
         tags: filters.tags,
         type: filters.type,
         featured: filters.featured,
       }),
       staleTime: 60_000, // 1 minute
     });
   }

   export function useResourceTags() {
     return useQuery({
       queryKey: ['resources', 'tags'],
       queryFn: () => resourcesApi.getTags(),
       staleTime: 5 * 60_000, // 5 minutes
     });
   }

   export function useResourceDetail(id: string | null) {
     return useQuery({
       queryKey: ['resources', id],
       queryFn: () => id ? resourcesApi.get(id) : null,
       enabled: !!id,
     });
   }

   export function useDownloadResource() {
     const queryClient = useQueryClient();

     return useMutation({
       mutationFn: (resourceId: string) => resourcesApi.download(resourceId),
       onSuccess: (data) => {
         // Open download URL in new tab
         window.open(data.url, '_blank');
         // Invalidate resources to update download counts
         queryClient.invalidateQueries({ queryKey: ['resources'] });
       },
     });
   }
   ```
  </action>
  <verify>
    - No TypeScript errors in useResources.ts
    - api.ts resourcesApi has getTags method
    - cd dashboard && npx tsc --noEmit passes
  </verify>
  <done>Resource hooks created with list, tags, detail, and download functionality</done>
</task>

<task type="auto">
  <name>Task 2: Create resource UI components</name>
  <files>
    dashboard/src/components/resources/ResourceCard.tsx
    dashboard/src/components/resources/ResourceListItem.tsx
    dashboard/src/components/resources/ResourceFilters.tsx
    dashboard/src/components/resources/ResourcePreviewModal.tsx
    dashboard/src/components/resources/index.ts
  </files>
  <action>
1. Create dashboard/src/components/resources/ResourceCard.tsx:
   - Grid view card showing: icon by type, title, description (truncated), tags
   - Show "Popular" badge if downloadCount > 50, "Trending" if > 20
   - Show featured star if isFeatured
   - Click opens preview modal (pass onClick prop)
   - Use Card component from @/components/ui
   - Icon mapping: TEMPLATE->FileText, SOP->ClipboardList, PLAYBOOK->BookOpen, COURSE->GraduationCap, VIDEO->Video
   - Mobile responsive: Use responsive padding (p-3 sm:p-4), truncate long text

2. Create dashboard/src/components/resources/ResourceListItem.tsx:
   - Horizontal row view with: icon, title, description inline, type badge, download count
   - Click handler same as card
   - Compact layout for list view
   - Mobile responsive: Stack content on small screens, use flex-col sm:flex-row

3. Create dashboard/src/components/resources/ResourceFilters.tsx:
   - Horizontal filter bar with:
     - Search input with Search icon (debounced 300ms)
     - Type dropdown (All, Template, SOP, Playbook, Course, Video)
     - Tags dropdown (populated from useResourceTags)
     - Grid/List toggle buttons (Grid3X3, List icons)
   - Accept onFiltersChange callback and viewMode/onViewModeChange
   - Mobile responsive: Stack filters on mobile (flex-col sm:flex-row), full-width inputs on mobile

4. Create dashboard/src/components/resources/ResourcePreviewModal.tsx:
   - Modal overlay (click outside to close)
   - Show: title, full description, type, tags, author if available
   - Show file size formatted (KB/MB)
   - Download button using useDownloadResource mutation
   - Show "Downloading..." state when mutation pending
   - Show "+5 Gold" badge on download button
   - After download, show "Downloaded!" confirmation briefly
   - Mobile responsive: Full-width modal on mobile (w-full sm:max-w-lg), larger touch targets for buttons

5. Create dashboard/src/components/resources/index.ts:
   - Barrel export all components
  </action>
  <verify>
    - All files created without TypeScript errors
    - Components use consistent pixel-shadow theme (8px border-radius, pixel-border class)
    - Icons imported from lucide-react
    - Components include responsive Tailwind classes (sm:, md:, lg: breakpoints)
  </verify>
  <done>Resource UI component library created with grid/list cards, filters, and preview modal</done>
</task>

<task type="auto">
  <name>Task 3: Create resources page with browser UI</name>
  <files>
    dashboard/src/app/dashboard/resources/page.tsx
  </files>
  <action>
1. Create dashboard/src/app/dashboard/resources/page.tsx:
   ```typescript
   'use client';

   import { useState } from 'react';
   import { GoldCoinsLoader, Card } from '@/components/ui';
   import {
     ResourceCard,
     ResourceListItem,
     ResourceFilters,
     ResourcePreviewModal,
   } from '@/components/resources';
   import { useResources } from '@/hooks/useResources';
   import type { Resource } from '@/lib/api';

   type ViewMode = 'grid' | 'list';

   export default function ResourcesPage() {
     const [viewMode, setViewMode] = useState<ViewMode>('grid');
     const [filters, setFilters] = useState({
       search: '',
       type: '',
       tags: '',
     });
     const [selectedResource, setSelectedResource] = useState<Resource | null>(null);

     const { data, isLoading, error } = useResources({
       search: filters.search || undefined,
       type: filters.type || undefined,
       tags: filters.tags || undefined,
     });

     const handleResourceClick = (resource: Resource) => {
       setSelectedResource(resource);
     };

     if (isLoading) {
       return (
         <div className="flex items-center justify-center h-64">
           <GoldCoinsLoader />
         </div>
       );
     }

     if (error) {
       return (
         <Card className="p-6 text-center">
           <p className="text-muted-foreground">Failed to load resources</p>
         </Card>
       );
     }

     return (
       <div className="space-y-6">
         <div>
           <h1 className="text-2xl font-bold text-foreground mb-2">Resource Vault</h1>
           <p className="text-muted-foreground">
             Download templates, SOPs, and playbooks. Earn +5 gold per download.
           </p>
         </div>

         <ResourceFilters
           filters={filters}
           onFiltersChange={setFilters}
           viewMode={viewMode}
           onViewModeChange={setViewMode}
         />

         {data?.resources.length === 0 ? (
           <Card className="p-12 text-center">
             <p className="text-muted-foreground">No resources match your filters.</p>
           </Card>
         ) : viewMode === 'grid' ? (
           <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
             {data?.resources.map((resource) => (
               <ResourceCard
                 key={resource.id}
                 resource={resource}
                 onClick={() => handleResourceClick(resource)}
               />
             ))}
           </div>
         ) : (
           <div className="divide-y divide-border border border-border rounded-[8px]">
             {data?.resources.map((resource) => (
               <ResourceListItem
                 key={resource.id}
                 resource={resource}
                 onClick={() => handleResourceClick(resource)}
               />
             ))}
           </div>
         )}

         {selectedResource && (
           <ResourcePreviewModal
             resource={selectedResource}
             onClose={() => setSelectedResource(null)}
           />
         )}
       </div>
     );
   }
   ```

2. Ensure medieval theme consistency:
   - Use 8px border-radius everywhere
   - Use pixel-border class for emphasized elements
   - Gold accents for interactive elements
  </action>
  <verify>
    - cd dashboard && npm run build succeeds
    - Navigate to /dashboard/resources in browser
    - Resources load and display in grid view
    - Toggle to list view works
    - Search filters resources by title/description
    - Type dropdown filters by resource type
    - Click resource opens preview modal
    - Download button triggers download and shows point award
    - Mobile test at 375px width:
      - Grid shows single column
      - Filters stack vertically
      - Modal is full-width with scrollable content
      - All touch targets are at least 44px
  </verify>
  <done>Resources page fully functional with filtering, views, and download</done>
</task>

</tasks>

<verification>
1. Navigate to /dashboard/resources - page loads
2. Search "template" - filters to matching resources
3. Select type filter - resources filter correctly
4. Toggle grid/list - layout changes
5. Click resource - modal opens with details
6. Click download - new tab opens with file, +5 points shown
7. Network tab shows /api/resources calls with query params
8. Mobile test at 375px width:
   - Page header readable
   - Filters stack and remain usable
   - Grid shows single column of cards
   - Modal opens full-width and is scrollable
   - Download button is tappable
</verification>

<success_criteria>
- UI-04: Resource library browser with filtering and search
- UI-05: Resource detail page (modal) with download button
- UI-11: Mobile responsive - verified at 375px breakpoint
- UI-12: Loading states prevent confusion
- GAME-02: Download awards +5 points (via backend, shown in UI)
</success_criteria>

<output>
After completion, create `.planning/phases/32-member-dashboard-pages/32-02-SUMMARY.md`
</output>
