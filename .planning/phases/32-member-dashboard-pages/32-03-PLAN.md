---
phase: 32-member-dashboard-pages
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/package.json
  - dashboard/src/lib/api.ts
  - dashboard/src/hooks/useBenchmarks.ts
  - dashboard/src/components/benchmarks/CategoryCard.tsx
  - dashboard/src/components/benchmarks/ConversationalWizard.tsx
  - dashboard/src/components/benchmarks/index.ts
  - dashboard/src/app/dashboard/benchmarks/page.tsx
autonomous: true

must_haves:
  truths:
    - "Member can see all 4 benchmark categories with submission status"
    - "Member can start conversational submission for any category"
    - "Wizard shows one question at a time with progress indicator"
    - "Submission awards +50 points on completion"
  artifacts:
    - path: "dashboard/src/hooks/useBenchmarks.ts"
      provides: "Benchmark data and submission hooks"
      exports: ["useMySubmissions", "useSubmitBenchmark"]
    - path: "dashboard/src/components/benchmarks/ConversationalWizard.tsx"
      provides: "Question-by-question form wizard"
      exports: ["ConversationalWizard"]
    - path: "dashboard/src/app/dashboard/benchmarks/page.tsx"
      provides: "Benchmarks page with category selection and wizard"
      min_lines: 100
  key_links:
    - from: "ConversationalWizard"
      to: "/api/benchmarks/submit"
      via: "useSubmitBenchmark mutation"
      pattern: "useSubmitBenchmark\\("
    - from: "dashboard/src/app/dashboard/benchmarks/page.tsx"
      to: "ConversationalWizard"
      via: "Component rendering with category schema"
      pattern: "<ConversationalWizard"
---

<objective>
Build the benchmark submission page with conversational question-by-question wizard.

Purpose: Members can submit benchmark data for any of 4 categories using an engaging conversational flow. Earn +50 points per submission.

Output: /dashboard/benchmarks page with category selection and conversational submission wizard.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-member-dashboard-pages/32-CONTEXT.md
@.planning/phases/32-member-dashboard-pages/32-RESEARCH.md

# Existing files
@dashboard/src/lib/api.ts
@src/routes/benchmarks.ts
@src/benchmarks/schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install form libraries and create benchmark hooks</name>
  <files>
    dashboard/package.json
    dashboard/src/lib/api.ts
    dashboard/src/hooks/useBenchmarks.ts
  </files>
  <action>
1. Install react-hook-form and zod in dashboard:
   ```bash
   cd dashboard && npm install react-hook-form @hookform/resolvers zod
   ```

2. Update dashboard/src/lib/api.ts benchmarksApi:
   - Add getMySubmissions method: GET /api/benchmarks/my-submissions
   - Ensure submit returns { submission, outlierFields?, pointsAwarded }
   - Add BenchmarkSubmission interface with id, category, data, submittedAt

3. Create dashboard/src/hooks/useBenchmarks.ts:
   ```typescript
   'use client';

   import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
   import { benchmarksApi } from '@/lib/api';

   export type BenchmarkCategory = 'COMPENSATION' | 'INFRASTRUCTURE' | 'BUSINESS' | 'OPERATIONAL';

   export function useMySubmissions() {
     return useQuery({
       queryKey: ['benchmarks', 'my-submissions'],
       queryFn: () => benchmarksApi.getSubmissions(),
       staleTime: 60_000,
     });
   }

   export function useSubmitBenchmark() {
     const queryClient = useQueryClient();

     return useMutation({
       mutationFn: ({ category, data }: { category: BenchmarkCategory; data: Record<string, unknown> }) =>
         benchmarksApi.submit(category, data),
       onSuccess: () => {
         // Invalidate submissions to show new submission
         queryClient.invalidateQueries({ queryKey: ['benchmarks', 'my-submissions'] });
         // Invalidate points to show new total
         queryClient.invalidateQueries({ queryKey: ['points'] });
       },
     });
   }
   ```
  </action>
  <verify>
    - npm ls react-hook-form shows installed
    - npm ls zod shows installed
    - useBenchmarks.ts exports useMySubmissions and useSubmitBenchmark
    - No TypeScript errors: cd dashboard && npx tsc --noEmit
  </verify>
  <done>Form libraries installed and benchmark hooks created</done>
</task>

<task type="auto">
  <name>Task 2: Create benchmark UI components</name>
  <files>
    dashboard/src/components/benchmarks/CategoryCard.tsx
    dashboard/src/components/benchmarks/ConversationalWizard.tsx
    dashboard/src/components/benchmarks/index.ts
  </files>
  <action>
1. Create dashboard/src/components/benchmarks/CategoryCard.tsx:
   ```typescript
   'use client';

   import { Card, CardContent, Button } from '@/components/ui';
   import { Check, ChevronRight } from 'lucide-react';

   interface CategoryCardProps {
     title: string;
     description: string;
     icon: React.ReactNode;
     hasSubmitted: boolean;
     onStart: () => void;
   }

   export function CategoryCard({
     title,
     description,
     icon,
     hasSubmitted,
     onStart,
   }: CategoryCardProps) {
     return (
       <Card className="hover-lift cursor-pointer group" onClick={onStart}>
         <CardContent className="pt-4 sm:pt-6">
           <div className="flex items-start gap-3 sm:gap-4">
             <div className="p-2 sm:p-3 bg-accent rounded-[8px] text-foreground group-hover:bg-gold/10 group-hover:text-gold-dark transition-colors flex-shrink-0">
               {icon}
             </div>
             <div className="flex-1 min-w-0">
               <div className="flex items-center gap-2 flex-wrap">
                 <h3 className="font-semibold text-foreground group-hover:text-gold-dark transition-colors">
                   {title}
                 </h3>
                 {hasSubmitted && (
                   <span className="inline-flex items-center gap-1 px-2 py-0.5 bg-success/10 text-success text-xs rounded-full">
                     <Check size={12} />
                     Submitted
                   </span>
                 )}
               </div>
               <p className="text-sm text-muted-foreground mt-1 line-clamp-2">{description}</p>
               <p className="text-sm font-medium text-gold-dark mt-2">
                 {hasSubmitted ? 'Update submission' : '+50 Gold'}
               </p>
             </div>
             <ChevronRight className="text-muted-foreground group-hover:text-gold-dark transition-colors flex-shrink-0 hidden sm:block" />
           </div>
         </CardContent>
       </Card>
     );
   }
   ```

2. Create dashboard/src/components/benchmarks/ConversationalWizard.tsx:
   - Props: category, questions array, onSubmit callback, onCancel callback
   - State: currentStep (0-based index), formData object
   - Each question object: { field: string, question: string, type: 'number' | 'text' | 'select', options?: [], unit?: string, required?: boolean }
   - UI:
     - Progress indicator: "Question {current + 1} of {total}"
     - Current question text in large font
     - Input field styled with medieval theme
     - For numbers: show unit label (e.g., "$", "employees")
     - Back button (if not first question)
     - Next/Submit button
   - Validation: If required field is empty, show error
   - On final question, button says "Submit" and calls onSubmit with formData
   - After submit success, show "+50 Gold earned!" message
   - Mobile responsive:
     - Full-width layout on mobile
     - Larger input fields (min-h-[48px]) for touch
     - Progress bar instead of text on small screens
     - Vertically stacked buttons on mobile

3. Define question sets for each category (can be in separate file or inline):
   - COMPENSATION: salary ranges, equity percentages, bonus structures
   - INFRASTRUCTURE: tech stack, hosting costs, tool spend
   - BUSINESS: revenue, growth rate, CAC, LTV metrics
   - OPERATIONAL: team size, processes, workflows

4. Create dashboard/src/components/benchmarks/index.ts:
   - Barrel export CategoryCard and ConversationalWizard
  </action>
  <verify>
    - All component files created
    - ConversationalWizard handles state for multi-step form
    - Progress indicator shows current position
    - Validation prevents empty required fields
    - Components include responsive Tailwind classes for mobile
  </verify>
  <done>Benchmark components created with category cards and conversational wizard</done>
</task>

<task type="auto">
  <name>Task 3: Create benchmarks page</name>
  <files>
    dashboard/src/app/dashboard/benchmarks/page.tsx
  </files>
  <action>
Create dashboard/src/app/dashboard/benchmarks/page.tsx:

```typescript
'use client';

import { useState } from 'react';
import { GoldCoinsLoader, Card } from '@/components/ui';
import { CategoryCard, ConversationalWizard } from '@/components/benchmarks';
import { useMySubmissions, useSubmitBenchmark, BenchmarkCategory } from '@/hooks/useBenchmarks';
import { DollarSign, Server, TrendingUp, Users } from 'lucide-react';

// Question definitions for each category
const categoryQuestions: Record<BenchmarkCategory, { field: string; question: string; type: 'number' | 'text' | 'select'; unit?: string; required?: boolean; options?: { value: string; label: string }[] }[]> = {
  COMPENSATION: [
    { field: 'base_salary', question: 'What is your base salary?', type: 'number', unit: '$', required: true },
    { field: 'equity_percent', question: 'What percentage of equity do you have?', type: 'number', unit: '%' },
    { field: 'bonus_target', question: 'What is your target bonus percentage?', type: 'number', unit: '%' },
    { field: 'total_comp', question: 'What is your total compensation (including equity)?', type: 'number', unit: '$' },
  ],
  INFRASTRUCTURE: [
    { field: 'monthly_hosting', question: 'What is your monthly hosting/cloud spend?', type: 'number', unit: '$', required: true },
    { field: 'tool_count', question: 'How many SaaS tools does your team use?', type: 'number', required: true },
    { field: 'monthly_tooling', question: 'What is your monthly SaaS/tooling spend?', type: 'number', unit: '$' },
  ],
  BUSINESS: [
    { field: 'annual_revenue', question: 'What is your annual revenue?', type: 'number', unit: '$', required: true },
    { field: 'growth_rate', question: 'What is your year-over-year growth rate?', type: 'number', unit: '%' },
    { field: 'cac', question: 'What is your customer acquisition cost (CAC)?', type: 'number', unit: '$' },
    { field: 'ltv', question: 'What is your customer lifetime value (LTV)?', type: 'number', unit: '$' },
  ],
  OPERATIONAL: [
    { field: 'team_size', question: 'What is your total team size?', type: 'number', required: true },
    { field: 'eng_percent', question: 'What percentage of your team is engineering?', type: 'number', unit: '%' },
    { field: 'remote_percent', question: 'What percentage of your team is remote?', type: 'number', unit: '%' },
  ],
};

const categoryMeta: Record<BenchmarkCategory, { title: string; description: string; icon: React.ReactNode }> = {
  COMPENSATION: {
    title: 'Compensation',
    description: 'Salary, equity, and bonus benchmarks',
    icon: <DollarSign size={24} />,
  },
  INFRASTRUCTURE: {
    title: 'Infrastructure',
    description: 'Tech stack, hosting, and tooling costs',
    icon: <Server size={24} />,
  },
  BUSINESS: {
    title: 'Business Metrics',
    description: 'Revenue, growth, CAC, and LTV',
    icon: <TrendingUp size={24} />,
  },
  OPERATIONAL: {
    title: 'Operational',
    description: 'Team size, structure, and processes',
    icon: <Users size={24} />,
  },
};

export default function BenchmarksPage() {
  const [selectedCategory, setSelectedCategory] = useState<BenchmarkCategory | null>(null);
  const [showSuccess, setShowSuccess] = useState(false);

  const { data: submissions, isLoading } = useMySubmissions();
  const submitMutation = useSubmitBenchmark();

  const hasSubmitted = (category: BenchmarkCategory) =>
    submissions?.submissions?.some((s: { category: string }) => s.category === category) ?? false;

  const handleSubmit = async (data: Record<string, unknown>) => {
    if (!selectedCategory) return;

    await submitMutation.mutateAsync({ category: selectedCategory, data });
    setShowSuccess(true);
    setTimeout(() => {
      setShowSuccess(false);
      setSelectedCategory(null);
    }, 2000);
  };

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-64">
        <GoldCoinsLoader />
      </div>
    );
  }

  if (showSuccess) {
    return (
      <div className="flex flex-col items-center justify-center h-64 space-y-4">
        <div className="text-4xl">+50</div>
        <div className="text-xl font-semibold text-gold-dark">Gold Earned!</div>
        <p className="text-muted-foreground">Your benchmark has been submitted.</p>
      </div>
    );
  }

  if (selectedCategory) {
    return (
      <div className="max-w-2xl mx-auto px-4 sm:px-0">
        <ConversationalWizard
          category={selectedCategory}
          questions={categoryQuestions[selectedCategory]}
          onSubmit={handleSubmit}
          onCancel={() => setSelectedCategory(null)}
          isSubmitting={submitMutation.isPending}
        />
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-foreground mb-2">Peer Benchmarks</h1>
        <p className="text-muted-foreground">
          Share your data anonymously and see how you compare to peers. Earn +50 gold per submission.
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {(Object.keys(categoryMeta) as BenchmarkCategory[]).map((category) => (
          <CategoryCard
            key={category}
            title={categoryMeta[category].title}
            description={categoryMeta[category].description}
            icon={categoryMeta[category].icon}
            hasSubmitted={hasSubmitted(category)}
            onStart={() => setSelectedCategory(category)}
          />
        ))}
      </div>

      <Card className="p-4">
        <p className="text-sm text-muted-foreground">
          All benchmark data is anonymized and aggregated. Individual submissions are never shared.
          Results require 5+ submissions per category to protect privacy.
        </p>
      </Card>
    </div>
  );
}
```
  </action>
  <verify>
    - cd dashboard && npm run build succeeds
    - Navigate to /dashboard/benchmarks
    - Four category cards display with icons
    - Click category opens wizard
    - Wizard shows questions one at a time
    - Progress shows "Question X of Y"
    - Submit triggers API call and shows success
    - Categories with submissions show "Submitted" badge
    - Mobile test at 375px width:
      - Category cards stack to single column
      - Cards are full width and tappable
      - Wizard fits in viewport
      - Input fields are large enough for touch
      - Back/Next buttons are easily tappable
  </verify>
  <done>Benchmarks page complete with category selection and conversational submission</done>
</task>

</tasks>

<verification>
1. Navigate to /dashboard/benchmarks - page shows 4 categories
2. Click "Compensation" - wizard opens at question 1
3. Answer questions using Next button
4. On final question, click Submit
5. Success message shows "+50 Gold Earned!"
6. Return to category list - shows "Submitted" badge
7. Network tab shows POST /api/benchmarks/submit with category and data
8. Mobile test at 375px width:
   - Category cards stack vertically
   - Wizard questions are readable
   - Input fields are touch-friendly (min 44px height)
   - Progress indicator visible
   - Buttons are full-width and tappable
</verification>

<success_criteria>
- UI-02: Benchmark submission page with forms for all 4 categories
- UI-11: Mobile responsive - verified at 375px breakpoint
- UI-12: Loading states during submission
- UI-13: Form validation shows helpful error messages
- GAME-01: +50 points shown on submission (backend awards)
</success_criteria>

<output>
After completion, create `.planning/phases/32-member-dashboard-pages/32-03-SUMMARY.md`
</output>
