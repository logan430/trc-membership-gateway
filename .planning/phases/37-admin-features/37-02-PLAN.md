---
phase: 37-admin-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/src/app/admin/benchmarks/page.tsx
  - dashboard/src/components/admin/FlaggedBenchmarkCard.tsx
autonomous: true

must_haves:
  truths:
    - "Admin sees flagged benchmarks in a table format"
    - "Admin can select multiple benchmarks via checkboxes"
    - "Admin can approve or reject all selected benchmarks at once"
    - "Bulk action shows progress and handles partial failures"
  artifacts:
    - path: "dashboard/src/app/admin/benchmarks/page.tsx"
      provides: "Table-based benchmark moderation with bulk actions"
      min_lines: 200
  key_links:
    - from: "dashboard/src/app/admin/benchmarks/page.tsx"
      to: "useApproveBenchmark, useRejectBenchmark"
      via: "Promise.allSettled for bulk operations"
      pattern: "Promise\\.allSettled"
---

<objective>
Enhance the Benchmarks Moderation page from card-based layout to table-based with bulk selection and batch approve/reject.

Purpose: Per CONTEXT.md decisions, admins need a compact table view with checkboxes for selecting multiple submissions and batch actions to approve or reject them in one operation.

Output: Refactored benchmarks/page.tsx with table layout, checkbox selection, bulk action bar, and individual row actions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/37-admin-features/37-CONTEXT.md
@.planning/phases/37-admin-features/37-RESEARCH.md
@dashboard/src/app/admin/benchmarks/page.tsx
@dashboard/src/components/admin/FlaggedBenchmarkCard.tsx
@dashboard/src/hooks/useAdminBenchmarks.ts
@dashboard/src/components/admin/MembersTable.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert to Table Layout with Bulk Selection</name>
  <files>dashboard/src/app/admin/benchmarks/page.tsx</files>
  <action>
Replace the card-based list with a table-based layout with bulk actions:

1. Add selection state at page level:
   ```typescript
   const [selected, setSelected] = useState<Set<string>>(new Set());
   ```

2. Create helper functions:
   - toggleSelect(id: string) - add/remove from Set
   - selectAll() - add all visible submission IDs
   - clearSelection() - empty the Set

3. Create BulkActionBar component (inline or extracted):
   - Only show when selected.size > 0
   - Display: "{N} selected" text
   - "Approve All" button - calls handleBulkApprove
   - "Reject All" button - calls handleBulkReject
   - "Clear" button - calls clearSelection
   - Use sticky positioning: `sticky top-0 bg-card border-b border-border p-3`

4. Create handleBulkApprove and handleBulkReject functions:
   - Use Promise.allSettled() to run all mutations in parallel
   - Show loading state during operation (disable buttons, show spinner)
   - On completion: invalidate queries, clear selection
   - Handle partial failures: show toast or alert with count of failures
   - Pattern:
   ```typescript
   const handleBulkApprove = async () => {
     setIsBulkPending(true);
     const results = await Promise.allSettled(
       Array.from(selected).map(id => approveMutation.mutateAsync(id))
     );
     const failures = results.filter(r => r.status === 'rejected').length;
     if (failures > 0) {
       alert(`${failures} of ${selected.size} failed to approve`);
     }
     clearSelection();
     setIsBulkPending(false);
   };
   ```

5. Replace FlaggedBenchmarkCard list with table:
   - Columns: Checkbox, Member, Category, Outlier Fields, Submitted, Actions
   - Each row has checkbox that calls toggleSelect
   - Actions column has individual Approve/Reject icon buttons (keep existing logic)
   - Use expandable row for data preview (click to expand, show JSON)

6. Keep existing stats cards and category filter at top
7. Table should be within Card component for consistent styling
  </action>
  <verify>
Run `npm run build --prefix dashboard` - should compile without errors.
Visit /admin/benchmarks - should show table with checkboxes.
Select multiple items - bulk action bar should appear.
Click "Approve All" - should process all and clear selection.
  </verify>
  <done>
Benchmarks page displays as table with checkboxes, bulk action bar appears on selection, batch approve/reject works with partial failure handling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update FlaggedBenchmarkCard for Row Mode</name>
  <files>dashboard/src/components/admin/FlaggedBenchmarkCard.tsx</files>
  <action>
The FlaggedBenchmarkCard component may still be useful for expanded details, but the main page now uses table rows.

Options (choose based on implementation):
A) Keep FlaggedBenchmarkCard for the expandable data view within table rows
B) Remove FlaggedBenchmarkCard entirely and inline the expand logic in the page

Recommended: Option B - inline the expand logic in the benchmarks page to avoid confusion.

If keeping the component, rename to FlaggedBenchmarkDetails and use it only for the expanded JSON view:
- Remove the Card wrapper
- Remove individual approve/reject buttons (handled by table row)
- Just show the JSON data in a pre block when expanded

If removing, ensure the expand toggle and JSON preview are implemented directly in the table row.
  </action>
  <verify>
If component kept: Import statement works, expanded view shows data.
If component removed: Benchmarks page still compiles and works, JSON preview shows when row expanded.
  </verify>
  <done>
Either FlaggedBenchmarkCard is simplified to detail-only OR expand logic is inlined in page. No duplicate approve/reject UI.
  </done>
</task>

</tasks>

<verification>
1. Page loads with table layout showing flagged benchmarks
2. Checkbox in header selects/deselects all
3. Individual checkboxes work
4. Bulk action bar appears when 1+ items selected
5. "Approve All" approves all selected items
6. "Reject All" rejects all selected items
7. Partial failures show error count
8. Individual row approve/reject still works
9. Expanded row shows submission JSON data
</verification>

<success_criteria>
- Table layout with checkbox column
- Bulk action bar with Approve All, Reject All, Clear
- Promise.allSettled handles parallel mutations
- Partial failures reported to admin
- Individual row actions preserved
- Stats cards and category filter unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/37-admin-features/37-02-SUMMARY.md`
</output>
