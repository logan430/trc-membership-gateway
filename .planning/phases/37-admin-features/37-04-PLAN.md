---
phase: 37-admin-features
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/src/app/admin/resources/page.tsx
  - dashboard/src/app/admin/resources/[id]/page.tsx
  - dashboard/src/components/admin/ResourceUploader.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can drag files onto upload zone"
    - "Resources can be marked as featured"
    - "Version history is collapsed by default in list view"
    - "Download analytics shown only in detail view"
  artifacts:
    - path: "dashboard/src/app/admin/resources/page.tsx"
      provides: "Resource list with drag-drop upload zone and collapsed version info"
      min_lines: 150
    - path: "dashboard/src/components/admin/ResourceUploader.tsx"
      provides: "Upload component with drag-drop event handling"
      min_lines: 80
  key_links:
    - from: "dashboard/src/components/admin/ResourceUploader.tsx"
      to: "onDragOver, onDrop events"
      via: "HTML5 drag and drop API"
      pattern: "onDrop.*dataTransfer"
---

<objective>
Enhance the Resource Management page with drag-drop upload, featured flag management, and collapsible version history.

Purpose: Per CONTEXT.md decisions, admins need a better upload experience with drag-drop, ability to feature resources, and cleaner list view with version history collapsed.

Output: Updated resources pages with drag-drop upload zone, featured toggle, and reorganized UI showing analytics only in detail view.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/37-admin-features/37-CONTEXT.md
@.planning/phases/37-admin-features/37-RESEARCH.md
@dashboard/src/app/admin/resources/page.tsx
@dashboard/src/app/admin/resources/[id]/page.tsx
@dashboard/src/components/admin/ResourceUploader.tsx
@dashboard/src/hooks/useAdminResources.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Upload Zone with Drag-Drop</name>
  <files>dashboard/src/components/admin/ResourceUploader.tsx</files>
  <action>
Add proper HTML5 drag-and-drop event handling to the upload component:

1. Add drag state:
   ```typescript
   const [isDragging, setIsDragging] = useState(false);
   ```

2. Add drag event handlers:
   ```typescript
   const handleDragOver = (e: React.DragEvent) => {
     e.preventDefault();
     e.stopPropagation();
   };

   const handleDragEnter = (e: React.DragEvent) => {
     e.preventDefault();
     e.stopPropagation();
     setIsDragging(true);
   };

   const handleDragLeave = (e: React.DragEvent) => {
     e.preventDefault();
     e.stopPropagation();
     // Only set false if leaving the drop zone entirely
     if (e.currentTarget.contains(e.relatedTarget as Node)) return;
     setIsDragging(false);
   };

   const handleDrop = (e: React.DragEvent) => {
     e.preventDefault();
     e.stopPropagation();
     setIsDragging(false);

     const files = e.dataTransfer.files;
     if (files.length > 0) {
       // Set the file in form state
       setFile(files[0]);
     }
   };
   ```

3. Update the drop zone UI:
   - Add event handlers to container div
   - Visual feedback when dragging: border-dashed, border-gold, bg-gold/10
   - Show "Drop file here" message when dragging
   - Keep click-to-browse functionality via hidden input

4. Make the drop zone visually prominent:
   ```tsx
   <div
     onDragOver={handleDragOver}
     onDragEnter={handleDragEnter}
     onDragLeave={handleDragLeave}
     onDrop={handleDrop}
     className={`
       border-2 border-dashed rounded-lg p-8 text-center cursor-pointer
       transition-colors duration-200
       ${isDragging
         ? 'border-gold bg-gold/10'
         : 'border-border hover:border-gold/50'}
     `}
   >
     {isDragging ? (
       <p className="text-gold font-medium">Drop file here</p>
     ) : (
       <>
         <Upload className="w-8 h-8 mx-auto mb-2 text-muted-foreground" />
         <p className="text-muted-foreground">
           Drag and drop a file here, or click to browse
         </p>
       </>
     )}
     <input type="file" ... />
   </div>
   ```
  </action>
  <verify>
Run `npm run build --prefix dashboard` - should compile without errors.
Open /admin/resources, click Upload - uploader should appear.
Drag a file over - zone should highlight with gold border.
Drop file - file should be selected in form.
  </verify>
  <done>
ResourceUploader has working drag-drop with visual feedback, file selection works both via drag-drop and click-to-browse.
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean Up Resource List View</name>
  <files>dashboard/src/app/admin/resources/page.tsx</files>
  <action>
Adjust the resource list to match CONTEXT.md decisions:

1. Remove download count from list view:
   - Currently shows: `v{resource.currentVersionNumber} | {resource.downloadCount} downloads`
   - Change to: `v{resource.currentVersionNumber}`
   - Download analytics should only appear in detail view

2. Add featured badge if resource.isFeatured:
   ```tsx
   {resource.isFeatured && (
     <span className="text-xs px-2 py-1 bg-gold/20 text-gold rounded">
       Featured
     </span>
   )}
   ```

3. Keep version number in list (collapsed version "history" - just show current version):
   - Version history expanded view is already in detail page
   - List just shows current version badge

4. Optional: Add quick-toggle for featured status if API supports PATCH:
   - Check if useUpdateResource exists and supports partial updates
   - If so, add star icon button that toggles isFeatured
   - If not, admin must go to detail page to toggle

5. Keep existing filters (type, status, search) and delete functionality
  </action>
  <verify>
Visit /admin/resources - list should NOT show download counts.
Featured resources should have "Featured" badge.
Click Edit to go to detail page - downloads should show there.
  </verify>
  <done>
Resource list shows version but not download count, featured resources have badge, analytics visible only in detail view.
  </done>
</task>

<task type="auto">
  <name>Task 3: Ensure Detail Page Has Full Analytics</name>
  <files>dashboard/src/app/admin/resources/[id]/page.tsx</files>
  <action>
Verify the detail page shows download analytics that were removed from list:

1. Check if detail page already shows download count - if yes, no changes needed
2. If not, add analytics section:
   ```tsx
   <Card className="p-4">
     <h3 className="font-semibold mb-3">Analytics</h3>
     <div className="grid grid-cols-2 gap-4">
       <div>
         <p className="text-2xl font-bold text-gold">{resource.downloadCount}</p>
         <p className="text-sm text-muted-foreground">Total Downloads</p>
       </div>
       {/* Add more analytics if available from API */}
     </div>
   </Card>
   ```

3. Ensure version history section is visible and shows all versions:
   - This is likely already implemented in sidebar or main content
   - Verify it's expandable/collapsible if many versions exist

4. Ensure featured toggle is available in edit form:
   - Checkbox or toggle for isFeatured field
   - Should save when form is submitted
  </action>
  <verify>
Visit /admin/resources/{id} for any resource.
Download count should be visible on detail page.
Version history should be visible (sidebar or section).
Featured toggle should be editable.
  </verify>
  <done>
Detail page shows download analytics, version history, and featured toggle. All analytics removed from list are accessible in detail.
  </done>
</task>

</tasks>

<verification>
1. Drag file over upload zone - border turns gold
2. Drop file - file is selected in form
3. Click upload zone - file browser opens (fallback works)
4. Resource list does NOT show download counts
5. Featured resources have "Featured" badge in list
6. Detail page shows download count
7. Detail page has version history visible
8. Detail page has featured toggle
</verification>

<success_criteria>
- Drag-drop upload works with visual feedback
- Download analytics moved from list to detail only
- Featured resources clearly marked in list
- Version history accessible in detail view
- All existing functionality preserved (filters, search, delete)
</success_criteria>

<output>
After completion, create `.planning/phases/37-admin-features/37-04-SUMMARY.md`
</output>
